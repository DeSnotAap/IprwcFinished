{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../../services/book.service\";\nimport * as i3 from \"../../services/cart.service\";\nimport * as i4 from \"../../services/auth.service\";\nimport * as i5 from \"@angular/common\";\n\nfunction BookDetailComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 4);\n    i0.ɵɵelement(1, \"div\", 5);\n    i0.ɵɵelementStart(2, \"p\");\n    i0.ɵɵtext(3, \"Loading...\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction BookDetailComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 6)(1, \"p\");\n    i0.ɵɵtext(2, \"An error occurred while loading the book. Please try again later.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 7);\n    i0.ɵɵtext(4, \"Back to Catalog\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction BookDetailComponent_div_3_span_39_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"Add to Cart\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction BookDetailComponent_div_3_span_40_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"Adding...\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction BookDetailComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 8)(1, \"div\", 9)(2, \"a\", 10);\n    i0.ɵɵelement(3, \"i\", 11);\n    i0.ɵɵtext(4, \" Back to Catalog \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(5, \"div\", 12)(6, \"div\", 13);\n    i0.ɵɵelement(7, \"img\", 14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"div\", 15)(9, \"span\", 16);\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"h1\", 17);\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"p\", 18);\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"div\", 19)(16, \"div\", 20)(17, \"span\", 21);\n    i0.ɵɵtext(18, \"ISBN:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"span\", 22);\n    i0.ɵɵtext(20);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(21, \"div\", 20)(22, \"span\", 21);\n    i0.ɵɵtext(23, \"Publication Date:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(24, \"span\", 22);\n    i0.ɵɵtext(25);\n    i0.ɵɵpipe(26, \"date\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(27, \"div\", 23);\n    i0.ɵɵtext(28);\n    i0.ɵɵpipe(29, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(30, \"div\", 24)(31, \"div\", 25)(32, \"button\", 26);\n    i0.ɵɵlistener(\"click\", function BookDetailComponent_div_3_Template_button_click_32_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return ctx_r5.decreaseQuantity();\n    });\n    i0.ɵɵtext(33, \"-\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(34, \"span\", 27);\n    i0.ɵɵtext(35);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(36, \"button\", 26);\n    i0.ɵɵlistener(\"click\", function BookDetailComponent_div_3_Template_button_click_36_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return ctx_r7.increaseQuantity();\n    });\n    i0.ɵɵtext(37, \"+\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(38, \"button\", 28);\n    i0.ɵɵlistener(\"click\", function BookDetailComponent_div_3_Template_button_click_38_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r8 = i0.ɵɵnextContext();\n      return ctx_r8.addToCart();\n    });\n    i0.ɵɵtemplate(39, BookDetailComponent_div_3_span_39_Template, 2, 0, \"span\", 29);\n    i0.ɵɵtemplate(40, BookDetailComponent_div_3_span_40_Template, 2, 0, \"span\", 29);\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(41, \"div\", 30)(42, \"h2\");\n    i0.ɵɵtext(43, \"Description\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(44, \"p\");\n    i0.ɵɵtext(45);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(46, \"div\", 31)(47, \"h2\");\n    i0.ɵɵtext(48, \"Related Books\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(49, \"p\", 32);\n    i0.ɵɵtext(50, \"Feature coming soon...\");\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"src\", ctx_r2.book.imageUrl, i0.ɵɵsanitizeUrl)(\"alt\", ctx_r2.book.title);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r2.book.categoryName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r2.book.title);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"by \", ctx_r2.book.author, \"\");\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(ctx_r2.book.isbn);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(26, 15, ctx_r2.book.publishedDate, \"dd/MM/yyyy\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(29, 18, ctx_r2.book.price, \"EUR\"));\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"disabled\", ctx_r2.quantity <= 1 || ctx_r2.addingToCart);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r2.quantity);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"disabled\", ctx_r2.addingToCart);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r2.addingToCart);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r2.addingToCart);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.addingToCart);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r2.book.description);\n  }\n}\n\nexport let BookDetailComponent = /*#__PURE__*/(() => {\n  class BookDetailComponent {\n    constructor(route, router, bookService, cartService, authService) {\n      this.route = route;\n      this.router = router;\n      this.bookService = bookService;\n      this.cartService = cartService;\n      this.authService = authService;\n      this.book = null;\n      this.loading = true;\n      this.error = false;\n      this.quantity = 1;\n      this.addingToCart = false;\n    }\n\n    ngOnInit() {\n      this.route.paramMap.subscribe(params => {\n        const bookId = Number(params.get('id'));\n\n        if (bookId) {\n          this.loadBook(bookId);\n        }\n      });\n    }\n\n    loadBook(id) {\n      this.loading = true;\n      this.error = false;\n      this.bookService.getBook(id).subscribe(data => {\n        this.book = data;\n        this.loading = false;\n      }, error => {\n        console.error('Error fetching book details:', error);\n        this.loading = false;\n        this.error = true;\n      });\n    }\n\n    decreaseQuantity() {\n      if (this.quantity > 1) {\n        this.quantity--;\n      }\n    }\n\n    increaseQuantity() {\n      this.quantity++;\n    }\n\n    addToCart() {\n      if (!this.authService.isLoggedIn()) {\n        // Redirect to login if not logged in\n        this.router.navigate(['/login'], {\n          queryParams: {\n            returnUrl: this.router.url\n          }\n        });\n        return;\n      }\n\n      if (this.book && !this.addingToCart) {\n        this.addingToCart = true;\n        this.cartService.addToCart(this.book.id, this.quantity).subscribe(response => {\n          var _a;\n\n          this.addingToCart = false;\n          alert(`Added ${this.quantity} of \"${(_a = this.book) === null || _a === void 0 ? void 0 : _a.title}\" to your cart.`); // Reset quantity to 1 after adding to cart\n\n          this.quantity = 1;\n        }, error => {\n          this.addingToCart = false;\n          console.error('Error adding to cart:', error);\n\n          if (error.status === 401) {\n            // Unauthorized, redirect to login\n            this.router.navigate(['/login'], {\n              queryParams: {\n                returnUrl: this.router.url\n              }\n            });\n          } else {\n            alert('Failed to add item to cart. Please try again.');\n          }\n        });\n      }\n    }\n\n  }\n\n  BookDetailComponent.ɵfac = function BookDetailComponent_Factory(t) {\n    return new (t || BookDetailComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.BookService), i0.ɵɵdirectiveInject(i3.CartService), i0.ɵɵdirectiveInject(i4.AuthService));\n  };\n\n  BookDetailComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: BookDetailComponent,\n    selectors: [[\"app-book-detail\"]],\n    decls: 4,\n    vars: 3,\n    consts: [[1, \"book-detail-container\"], [\"class\", \"loading-spinner\", 4, \"ngIf\"], [\"class\", \"error-message\", 4, \"ngIf\"], [\"class\", \"book-detail\", 4, \"ngIf\"], [1, \"loading-spinner\"], [1, \"spinner\"], [1, \"error-message\"], [\"routerLink\", \"/books\", 1, \"btn-primary\"], [1, \"book-detail\"], [1, \"navigation-links\"], [\"routerLink\", \"/books\", 1, \"back-link\"], [1, \"fa\", \"fa-arrow-left\"], [1, \"book-content\"], [1, \"book-image-container\"], [1, \"book-image\", 3, \"src\", \"alt\"], [1, \"book-info\"], [1, \"book-category\"], [1, \"book-title\"], [1, \"book-author\"], [1, \"book-meta\"], [1, \"meta-item\"], [1, \"meta-label\"], [1, \"meta-value\"], [1, \"book-price\"], [1, \"add-to-cart\"], [1, \"quantity-control\"], [1, \"quantity-btn\", 3, \"disabled\", \"click\"], [1, \"quantity-display\"], [1, \"btn-primary\", \"add-to-cart-btn\", 3, \"disabled\", \"click\"], [4, \"ngIf\"], [1, \"book-description\"], [1, \"related-books\"], [1, \"coming-soon\"]],\n    template: function BookDetailComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵtemplate(1, BookDetailComponent_div_1_Template, 4, 0, \"div\", 1);\n        i0.ɵɵtemplate(2, BookDetailComponent_div_2_Template, 5, 0, \"div\", 2);\n        i0.ɵɵtemplate(3, BookDetailComponent_div_3_Template, 51, 21, \"div\", 3);\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.loading);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.error);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.loading && !ctx.error && ctx.book);\n      }\n    },\n    directives: [i5.NgIf, i1.RouterLink, i1.RouterLinkWithHref],\n    pipes: [i5.DatePipe, i5.CurrencyPipe],\n    styles: [\".book-detail-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:2rem 1rem}.loading-spinner[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:400px}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid rgba(139,0,0,.1);border-radius:50%;border-top-color:#8b0000;animation:spin 1s linear infinite;margin-bottom:1rem}@keyframes spin{to{transform:rotate(360deg)}}.error-message[_ngcontent-%COMP%]{text-align:center;padding:3rem;color:#666}.error-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:1.5rem;font-size:1.1rem}.book-detail[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px;box-shadow:0 2px 10px #0000001a;overflow:hidden}.navigation-links[_ngcontent-%COMP%]{padding:1rem;background-color:#f8f8f8}.back-link[_ngcontent-%COMP%]{display:inline-block;color:#666;text-decoration:none;transition:color .2s ease}.back-link[_ngcontent-%COMP%]:hover{color:#8b0000}.back-link[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.5rem}.book-content[_ngcontent-%COMP%]{display:flex;padding:2rem}.book-image-container[_ngcontent-%COMP%]{flex:0 0 300px;margin-right:2rem}.book-image[_ngcontent-%COMP%]{width:100%;height:auto;box-shadow:0 4px 8px #0003;border-radius:4px}.book-info[_ngcontent-%COMP%]{flex:1}.book-category[_ngcontent-%COMP%]{display:inline-block;background-color:#f0f0f0;color:#666;font-size:.8rem;padding:.3rem .7rem;border-radius:4px;margin-bottom:1rem}.book-title[_ngcontent-%COMP%]{font-size:1.8rem;color:#333;margin:0 0 .5rem}.book-author[_ngcontent-%COMP%]{color:#666;font-style:italic;margin-bottom:1.5rem;font-size:1.1rem}.book-meta[_ngcontent-%COMP%]{margin-bottom:1.5rem}.meta-item[_ngcontent-%COMP%]{margin-bottom:.5rem}.meta-label[_ngcontent-%COMP%]{font-weight:700;color:#555;margin-right:.5rem}.meta-value[_ngcontent-%COMP%]{color:#666}.book-price[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#8b0000;margin-bottom:1rem}.book-availability[_ngcontent-%COMP%]{font-size:1rem;color:#2e7d32;margin-bottom:1.5rem}.book-availability.out-of-stock[_ngcontent-%COMP%]{color:#c62828}.add-to-cart[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:1.5rem}.quantity-control[_ngcontent-%COMP%]{display:flex;align-items:center;margin-right:1rem;border:1px solid #ddd;border-radius:4px;overflow:hidden}.quantity-btn[_ngcontent-%COMP%]{background-color:#f8f8f8;border:none;color:#333;width:2.5rem;height:2.5rem;font-size:1.2rem;cursor:pointer;transition:background-color .2s ease}.quantity-btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#e0e0e0}.quantity-btn[_ngcontent-%COMP%]:disabled{color:#aaa;cursor:not-allowed}.quantity-display[_ngcontent-%COMP%]{width:3rem;text-align:center;font-size:1rem}.add-to-cart-btn[_ngcontent-%COMP%], .out-of-stock-actions[_ngcontent-%COMP%]   .btn-outline[_ngcontent-%COMP%]{padding:.7rem 1.5rem;font-size:1rem}.book-description[_ngcontent-%COMP%]{padding:0 2rem 2rem}.book-description[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#333;font-size:1.5rem;margin-bottom:1rem;padding-bottom:.5rem;border-bottom:1px solid #eee}.book-description[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666;line-height:1.6;white-space:pre-line}.related-books[_ngcontent-%COMP%]{padding:0 2rem 2rem}.related-books[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#333;font-size:1.5rem;margin-bottom:1rem;padding-bottom:.5rem;border-bottom:1px solid #eee}.coming-soon[_ngcontent-%COMP%]{color:#888;font-style:italic}@media (max-width: 768px){.book-content[_ngcontent-%COMP%]{flex-direction:column}.book-image-container[_ngcontent-%COMP%]{flex:0 0 auto;margin-right:0;margin-bottom:2rem;max-width:300px}.add-to-cart[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.quantity-control[_ngcontent-%COMP%]{margin-right:0;margin-bottom:1rem}}\"]\n  });\n  return BookDetailComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}